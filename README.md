
# GPT-4 SQL Data Agent

This project allows developers to interact with a CSV file using SQL-like queries, where the queries are generated based on natural language input by GPT-4. The application uses Streamlit as the user interface, and `pandasql` is utilized to execute SQL queries on a pandas DataFrame loaded from a CSV file.

## Features

- Accepts natural language input to interact with CSV data.
- Translates natural language into SQL queries using GPT-4.
- Executes SQL queries on a CSV file using `pandasql`.
- Displays the generated SQL query and the result of the query.
- Works with an SQLite-like interface but on a DataFrame.

## Project Structure

```
GPT-4_SQL_Data_Agent/
│
├── app/
│   └── app.py                    # Main Streamlit application.
│
├── config/
│   ├── config.ini                # Configuration file for API keys and CSV path.
│   └── config.py                 # Reads configuration from config.ini.
│
├── database/
│   └── mock_patient_data.csv      # Mock CSV data file.
│
├── gpt_agent.py                  # GPT-4 logic for generating SQL queries.
├── requirements.txt              # Python dependencies.
└── README.md                     # Project documentation.
```

## Prerequisites

Before you begin, ensure you have met the following requirements:
- **Python 3.7+** installed on your machine.
- An **OpenAI API Key**. You can get one by signing up at [OpenAI](https://beta.openai.com/signup/).
- **Streamlit** for the web application interface.
- **pandasql** for running SQL queries on pandas DataFrames.

## Setup and Installation

1. Clone the repository to your local machine:

   ```bash
   git clone https://github.com/your-username/GPT-4_SQL_Data_Agent.git
   cd GPT-4_SQL_Data_Agent
   ```

2. Install the required Python packages:

   ```bash
   pip install -r requirements.txt
   ```

3. Set up your OpenAI API key:
   
   - Open the `config/config.ini` file and add your OpenAI API key:

     ```
     [openai]
     api_key = YOUR_OPENAI_API_KEY
     ```

4. Verify that the `mock_patient_data.csv` file is in the `database/` directory.

## Running the Application

To start the application, run the following command in the root of the project:

```bash
streamlit run app/app.py
```

This will start a local web server, and you can access the application by navigating to `http://localhost:8501` in your browser.

## Interacting with the Application

Once the application is running:
1. You can enter natural language requests like:
   - `"List all patient names"`
   - `"How many patients are older than 40?"`
   - `"Show patients who had a Blood Test"`
   
2. The application will generate the corresponding SQL query, execute it on the CSV data, and display the result.

### Example Input:
- **User Input**: `"List all patient names"`
- **Generated SQL Query**: `SELECT patient_name FROM df;`
- **Output**: List of patient names from the CSV.

## Project Files Overview

### 1. `app/app.py`
This is the main application file for Streamlit. It accepts user input, generates the SQL query through GPT-4, and runs the query on the CSV file. The result is displayed back to the user.

### 2. `config/config.py` & `config/config.ini`
- `config.py` reads the configuration file (`config.ini`), which contains the OpenAI API key and CSV file path.
- You can adjust the CSV path or other configurations here.

### 3. `gpt_agent.py`
This file contains the logic for communicating with the OpenAI GPT-4 model. It sends the user input to GPT-4, which generates a SQL query based on the provided natural language input.

### 4. `database/mock_patient_data.csv`
This is a mock CSV file with patient data. It is used for querying and testing the application.

### 5. `requirements.txt`
This file lists all the Python dependencies required to run the project, including:
- `openai` (for GPT-4 API integration)
- `streamlit` (for the web interface)
- `pandasql` (for SQL execution on DataFrames)
- `pandas` (for handling CSV files)

## Customization

### Changing the CSV File:
To use a different CSV file:
1. Place your CSV file in the `database/` folder.
2. Update the `csv_path` in the `config.ini` file to point to your new CSV file.

### Modifying Queries:
You can modify the SQL queries generated by GPT-4 by changing the prompt in `gpt_agent.py`. For example, you can include more detailed table structures or provide additional context to GPT-4 for generating specific types of queries.

## Common Issues

- **No such table error**: Ensure that the SQL query generated uses `df` as the table name. The application maps the CSV data to a pandas DataFrame named `df`, so all SQL queries must refer to this name.
- **OpenAI API errors**: Ensure your OpenAI API key is valid and has sufficient usage credits.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

## Acknowledgements

- [OpenAI](https://beta.openai.com/) for providing the GPT-4 API.
- [Streamlit](https://streamlit.io/) for the web application framework.
- [pandas](https://pandas.pydata.org/) and [pandasql](https://github.com/yhat/pandasql) for data manipulation and SQL querying.
